<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Discourse // AI Conversation Framework</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <canvas id="matrix-bg"></canvas>

    <!-- Decorative corner elements -->
    <div class="cyber-corner tl"></div>
    <div class="cyber-corner tr"></div>
    <div class="cyber-corner bl"></div>
    <div class="cyber-corner br"></div>

    <!-- Hex decoration overlay -->
    <div class="hex-decoration" id="hex-decoration"></div>

    <header class="header">
        <div class="logo">
            <canvas id="tesseract" width="100" height="100"></canvas>
            <span class="logo-text" data-text="Neural Discourse">Neural Discourse</span>
        </div>
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot" id="anthropic-status"></span>
                <span>Anthropic</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="groq-status"></span>
                <span>Groq</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="openai-status"></span>
                <span>OpenAI</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="xai-status"></span>
                <span>xAI</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="kimi-status"></span>
                <span>Kimi</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="gemini-status"></span>
                <span>Gemini</span>
            </div>
            <button class="settings-btn" onclick="openSettingsModal()">⚙ Keys</button>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="chat">// Chat</button>
        <button class="tab-btn" data-tab="instructions">// Instructions</button>
        <button class="tab-btn" data-tab="history">// History</button>
        <button class="tab-btn" data-tab="credits">// Credits</button>
    </nav>

    <!-- Tab Content: Chat (Default) -->
    <div class="tab-content active" id="tab-chat">
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobile-overlay" onclick="closeMobileSessions()"></div>

    <main class="main-container">
        <!-- Sidebar: Conversations -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Sessions</div>
                <button class="btn btn-primary btn-block" onclick="openNewConversationModal()">
                    [ + ] Initialize
                </button>
            </div>
            <div class="conversation-list" id="conversation-list">
                <!-- Populated by JS -->
            </div>
        </aside>

        <!-- Mobile Config Bar (visible only on mobile) -->
        <div class="mobile-config" id="mobile-config">
            <button class="mobile-btn" onclick="toggleMobileSessions()">☰ Sessions</button>
            <button class="mobile-btn" onclick="openNewConversationModal()">+ New</button>
            <button class="mobile-btn" onclick="openSettingsModal()">⚙ Keys</button>
        </div>

        <!-- Main Chat Area -->
        <section class="chat-container">
            <div class="chat-header" id="chat-header" style="display: none;">
                <div class="chat-title" id="chat-title">Select a conversation</div>
                <div class="chat-actions">
                    <button class="btn" onclick="exportConversation()">↓ Export</button>
                    <button class="btn" onclick="deleteCurrentConversation()">✕ Delete</button>
                    <button class="btn" onclick="clearSelection()">← Close</button>
                </div>
            </div>

            <div class="messages-container" id="messages-container">
                <div class="empty-state" id="empty-state">
                    <div class="empty-icon">⬡</div>
                    <div class="empty-text">Awaiting Input</div>
                    <div class="empty-hint">// Initialize a new session to begin model discourse</div>
                </div>
            </div>

            <div class="controls-panel" id="controls-panel" style="display: none;">
                <div class="turns-input">
                    <label for="turns">Cycles:</label>
                    <input type="number" id="turns" value="5" min="1" max="50">
                </div>
                <button class="btn btn-primary" id="run-btn" onclick="runConversation()">
                    ⬡ Execute
                </button>
                <div class="loading" id="loading" style="display: none;">
                    <span>Processing</span>
                    <div class="loading-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Panel -->
        <aside class="settings-panel" id="settings-panel" style="display: none;">
            <div class="settings-section">
                <div class="settings-title">Config</div>

                <div class="form-group">
                    <label class="form-label">Model A</label>
                    <select class="form-select" id="edit-model-a" disabled>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Model B</label>
                    <select class="form-select" id="edit-model-b" disabled>
                        <!-- Populated by JS -->
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">System Prompts</div>

                <div class="form-group">
                    <label class="form-label">Model A</label>
                    <textarea class="form-textarea" id="edit-system-a" readonly placeholder="null"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Model B</label>
                    <textarea class="form-textarea" id="edit-system-b" readonly placeholder="null"></textarea>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">Init Message</div>
                <div class="form-group">
                    <textarea class="form-textarea" id="edit-starter" readonly></textarea>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">Stats</div>
                <div id="session-stats" style="font-size: 0.65rem; color: var(--text-dim);">
                    <div>Messages: <span id="stat-messages">0</span></div>
                    <div>Tokens: <span id="stat-tokens">0</span></div>
                </div>
            </div>
        </aside>
    </main>
    </div>

    <!-- Tab Content: Instructions -->
    <div class="tab-content" id="tab-instructions">
        <div class="info-page">
            <div class="info-section">
                <h2 class="info-title">⬡ What is Neural Discourse?</h2>
                <p class="info-text">
                    Neural Discourse is a framework for orchestrating conversations between AI models.
                    Watch as two models engage in autonomous dialogue, exchanging ideas and exploring concepts
                    without human intervention.
                </p>
            </div>

            <div class="info-section">
                <h2 class="info-title">// How to Use</h2>
                <div class="info-steps">
                    <div class="info-step">
                        <span class="step-number">01</span>
                        <div>
                            <strong>Configure API Keys (Optional)</strong>
                            <p>Some providers may already be configured on the server. Check the status dots in the header - green means ready to use. You can add your own keys via "Keys" button if needed.</p>
                        </div>
                    </div>
                    <div class="info-step">
                        <span class="step-number">02</span>
                        <div>
                            <strong>Initialize Session</strong>
                            <p>Click "Initialize" to create a new conversation. Select two models and provide an opening prompt.</p>
                        </div>
                    </div>
                    <div class="info-step">
                        <span class="step-number">03</span>
                        <div>
                            <strong>Execute Cycles</strong>
                            <p>Set the number of turns and click "Execute". The models will take turns responding to each other.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h2 class="info-title">// Free Models via Groq</h2>
                <p class="info-text">
                    Want to try Neural Discourse for free? <strong>Groq</strong> offers free API access to open-source models:
                </p>
                <ul class="info-list">
                    <li><strong>Llama 3.3 70B</strong> - Meta's latest, very capable</li>
                    <li><strong>Mixtral 8x7B</strong> - Mistral's mixture-of-experts model</li>
                    <li><strong>Gemma 2 9B</strong> - Google's efficient open model</li>
                </ul>
                <p class="info-text">
                    Get your free API key at <a href="https://console.groq.com/" target="_blank" class="info-link">console.groq.com</a>,
                    then click "Keys" and paste it in the Groq field.
                </p>
            </div>

            <div class="info-section">
                <h2 class="info-title">// Supported Providers</h2>
                <div class="provider-tags">
                    <span class="provider-tag anthropic">Anthropic</span>
                    <span class="provider-tag groq">Groq (Free)</span>
                    <span class="provider-tag openai">OpenAI</span>
                    <span class="provider-tag xai">xAI</span>
                    <span class="provider-tag kimi">Kimi</span>
                    <span class="provider-tag gemini">Gemini</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content: History -->
    <div class="tab-content" id="tab-history">
        <div class="history-page">
            <div class="history-header">
                <h2 class="info-title">⬡ Session Network</h2>
                <p class="info-text">Visualization of conversation clusters based on shared topics.</p>
            </div>
            <div class="history-canvas-container">
                <canvas id="history-canvas"></canvas>
            </div>
            <div class="history-legend">
                <span class="legend-item"><span class="legend-dot neuron"></span> Session Node</span>
                <span class="legend-item"><span class="legend-line"></span> Shared Topics</span>
                <span class="legend-item">Hover for tags</span>
            </div>
        </div>
    </div>

    <!-- Tab Content: Credits -->
    <div class="tab-content" id="tab-credits">
        <div class="info-page">
            <div class="info-section">
                <h2 class="info-title">⬡ Neural Discourse</h2>
                <p class="info-text version">Version 1.0.0</p>
            </div>

            <div class="info-section">
                <h2 class="info-title">// Contact</h2>
                <p class="info-text">
                    <a href="mailto:mckanissa@proton.me" class="contact-link">mckanissa@proton.me</a>
                </p>
            </div>

            <div class="info-section">
                <h2 class="info-title">// Technologies</h2>
                <div class="tech-list">
                    <span class="tech-item">FastAPI</span>
                    <span class="tech-item">Python 3.11+</span>
                    <span class="tech-item">SQLite</span>
                    <span class="tech-item">Vanilla JS</span>
                    <span class="tech-item">CSS3</span>
                </div>
            </div>

            <div class="info-section">
                <h2 class="info-title">// AI Providers</h2>
                <div class="tech-list">
                    <span class="tech-item">Anthropic Claude</span>
                    <span class="tech-item">OpenAI GPT</span>
                    <span class="tech-item">Groq (Llama/Gemma)</span>
                    <span class="tech-item">xAI Grok</span>
                    <span class="tech-item">Moonshot Kimi</span>
                    <span class="tech-item">Google Gemini</span>
                </div>
            </div>

            <div class="info-section">
                <h2 class="info-title">// License</h2>
                <p class="info-text">MIT License - Open Source</p>
            </div>
        </div>
    </div>

    <!-- New Conversation Modal -->
    <div class="modal-overlay" id="new-conversation-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Init Session</h2>
                <button class="modal-close" onclick="closeModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Session ID</label>
                    <input type="text" class="form-input" id="new-title" placeholder="unnamed_session">
                </div>

                <div class="form-group">
                    <label class="form-label">Model A</label>
                    <select class="form-select" id="new-model-a">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Model A System</label>
                    <textarea class="form-textarea" id="new-system-a" placeholder="// optional instructions"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Model B</label>
                    <select class="form-select" id="new-model-b">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Model B System</label>
                    <textarea class="form-textarea" id="new-system-b" placeholder="// optional instructions"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Init Prompt</label>
                    <textarea class="form-textarea" id="new-starter" placeholder="// seed the discourse...">What is it like being you?</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">Abort</button>
                <button class="btn btn-primary" onclick="createConversation()">⬡ Execute</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">API Configuration</h2>
                <button class="modal-close" onclick="closeSettingsModal()">✕</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 0.7rem; color: var(--text-dim); margin-bottom: 1rem;">
                    // Keys are stored locally in your browser. Never shared.
                </p>

                <div class="form-group">
                    <label class="form-label">
                        Anthropic API Key
                        <span class="key-status" id="anthropic-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-anthropic-key"
                           placeholder="sk-ant-api03-...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key: <a href="https://console.anthropic.com/" target="_blank" style="color: var(--purple-primary);">console.anthropic.com</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Groq API Key
                        <span class="key-status" id="groq-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-groq-key"
                           placeholder="gsk_...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key (FREE): <a href="https://console.groq.com/" target="_blank" style="color: var(--green-primary);">console.groq.com</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        OpenAI API Key
                        <span class="key-status" id="openai-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-openai-key"
                           placeholder="sk-...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key: <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--cyan-primary);">platform.openai.com</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        xAI API Key (Grok)
                        <span class="key-status" id="xai-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-xai-key"
                           placeholder="xai-...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key: <a href="https://console.x.ai/" target="_blank" style="color: var(--text-secondary);">console.x.ai</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Kimi API Key (Moonshot)
                        <span class="key-status" id="kimi-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-kimi-key"
                           placeholder="sk-...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key: <a href="https://platform.moonshot.cn/" target="_blank" style="color: var(--cyan-primary);">platform.moonshot.cn</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Gemini API Key (Google)
                        <span class="key-status" id="gemini-key-status">checking...</span>
                    </label>
                    <input type="password" class="form-input api-key-input" id="settings-gemini-key"
                           placeholder="AI...">
                    <div style="font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem;">
                        Get key: <a href="https://aistudio.google.com/apikey" target="_blank" style="color: var(--blue-primary);">aistudio.google.com</a>
                    </div>
                </div>

                <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div style="font-size: 0.65rem; color: var(--text-dim); margin-bottom: 0.5rem;">// Pricing notes</div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">
                        <div>Groq: ~14,400 requests/day (free)</div>
                        <div>Gemini: Free tier available</div>
                        <div>Anthropic: Pay-per-token (~$3/1M input)</div>
                        <div>OpenAI: Pay-per-token (~$5/1M input)</div>
                        <div>xAI/Kimi: Pay-per-token (varies)</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="clearApiKeys()">Clear Keys</button>
                <button class="btn btn-primary" onclick="saveApiKeys()">⬡ Save</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
